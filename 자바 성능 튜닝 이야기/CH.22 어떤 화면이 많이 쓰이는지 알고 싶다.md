# CH.22 어떤 화면이 많이 쓰이는지 알고 싶다.
## 웹 로그란?
- 아파치나 Nginx, iPlanet과 같은 모든 웹 서버에 공통적으로 제공되는 기능이 웹 로그이다.
- 서버에 어떤 사용자가 어떤 요청을 하였고, 결과는 어떠한지 파일에 한 줄씩 쌓아준다.
- 한 화면을 구성하는 이미지, CSS, 자바스크립트, 플래시 파일 등 모든 파일에 대한 요청의 결과가 이 로그 파일에 쌓인다.
- 대부분 하나의 클라이언트에서 동일한 파일을 한 번 다운로드 받으면 304라는 리턴코드를 제공한다.
- 그래서 다시 다운로드 받지는 않지만, 서버에는 변경되었는지 확인하는 요청을 하므로, 이러한 내용도 하나하나 모두 로그에 남는다.
- 아파치 웹 서버의 웹 로그 설정 부분 -> httpd.conf 파일 -> 로그 포맷(logFormat)
```text
LogFormat "%h %1 %u %t \"%r\" %>s %b" common
```
```text
127.0.0.1 - - [22/0ct/20XX:14:04:43 +0900] "GET /a-gif HTTP/1.1" 200 2326
```
- 127.0.0.1 (%h): 클라이언트가 프록시(proxy) 서버를 사용할 경우 클라이언트의 실제주소가 아닌 프록시 서버의 주소가 이 부분에 표시된다.
- -(%l): '-'로 표시되어 있기 때문에 요청한 정보가 없음을 의미한다.
- -(%u): HTTP 인증을 통하여 확인된 문서를 요청한 사용자의 ID가 표시된다. 암호화되지 않은 페이지이기 때문에 이 항목도 앞의 항목과 같이 보통 '?'로 표시된다.
- [22/Oct/2007:14:04:43 +0900] (%t): 서버가 요청을 마친 시간이다.
- "GET /a.gif HTTP/1.1"("\%r\"): 요청 방식(method)이 가장 처음 나타나며, 그 다음에는 요청주소 (URL)가 표시된다. 가장 마지막에는 클라이언트에서 사용한 프로토콜의 종류와 버전이 표시된다.
- 200 (%>s): 만약 클 라이언트에 해당 파일이 존재한다면 304가 표시된다.
- 2326 (%b): 클라이언트로 전송한 데이터의 크기가 표시된다. 여기서 헤더정보의 크기는 포함되지 않는다. 이 파일의 경우 이미지 파일이기 때문에 여기에 표시된 전송데이터의 크기와 실제 전송된 파일의 크기는 동일하다.
- 여기에 설명되어 있는 로그포맷은 표준포맷으로, 어떤 웹 서버를 사용하더라도 대부분 동일하다.
- %D: 요청의 처리 시간을 마이크로초 단위로 나타낸다.
- %T: 요청의 처리 시간을 초 단위로 나타낸다.
- 무료 웹 로그 분석 툴
  - Analog (2005년 최종 update)
  - AWStats
  - Webalizer (2010년 최종 update)
- AWStats 기능
  - 방문 횟수와 방문자 수
  - 방문하여 페이지에 머무른 기간 및 마지막 방문일
  - 각 시간 및 요일별 방문 페이지 수와 네트워크 사용량
  - 방문자의 국가 (GeolP 활용)
  - 가장 많이 본 페이지, 유입 경로 및 마지막 페이지
  - 웹 압축 통계
  - 사용 OS 및 브라우저 통계
  - 방문 검색 로봇의 횟수
  - 검색 엔진 및 검색 키워드
  - HTTP 에러 목록
  - 즐겨찾기 북마크에 추가된 횟수
  - 화면 크기
## 웹 로그를 통해서 접근 통계를 분석하기 싫다면...
- 구글에서 제공하고 있는 'Google 애널리틱스'도 웹 사용자 통계를 제공하는 막강한 무료툴 중 하나이다.
- 하지만 이 툴은 웹 로그기반의 툴은 아니라, 접근하는 모든 페이지에 정보를 전달하는 자바 스크립트 코드를 넣고 구글 서버에 데이터를 쌓는 방식이다.
- 모든 정보는 구글에 위치하기 때문에, 개인 홈페이지가 아닌 회사의 서버에 구글 애널리틱스를 설치하면 회사의 사용량 정보가 유출될 우려가 있다.
- Piwik은 오픈소스로 제공되는 웹 페이지 접근통계 툴이며, 일반 브라우저 뿐만 아니라 안드로이드나 아이폰 등 모바일 기기에서도 데이터를 확인할 수 있다.
- Piwik 주요 기능
  - 실시간 사용량 정보
  - 방문자에 대한 상세한 정보
  - 변경 가능한 대시보드
  - 내부 검색엔진을 통한 검색 기능
  - 방문자의 위치에 대한 세계 지도
- Piwik에서 제공하는 막강한 기능 중 하나는 바로 플러그인을 제공한다는 것이다.
- Jenkins, Sonar 등 개발과 연관된 웹 페이지에서 사용할 수 있는 플러그인 뿐만이 아니라, PHP, Java, python, django, Grails, Ruby, Objective-C, node.js 등 여러 언어에서 사용할 수 있는 API도 제공한다.
- Piwik을 우리 회사 서버에 설치해서 사용하려면 어떤 것들이 준비되어야 할까?
- 데이터를 수집하는 수집서버가 필요할 것이다.