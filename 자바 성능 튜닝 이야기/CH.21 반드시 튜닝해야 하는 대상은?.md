# CH.21 반드시 튜닝해야 하는 대상은?
## 반드시 튜닝해야 하는 대상 선정
- 가장 많이 수행하는 상위 20%의 화면을 분석 및 튜닝 대상으로 선정
- 상위 20%의 사용량을 점유하는 화면을 어떻게 찾을까?
- 기존 시스템이 있다면, 기존 시스템 모니터링 툴의 통계기능을 사용하여 쉽게 대상을 찾을 수 있다.
- 모니터링 툴 없이 기존 시스템을 사용해 왔다면 기존 시스템의 웹 로그(Access log)를 분석하는 방법이 있다.
- 기존 시스템 없이 새로운 시스템을 만들 경우에는 어떻게 해야 할까?
- 고객에게 예상되는 화면을 선정해 달라고 요청하면 된다.
- 병원 시스템

| 구분 | 화면명                                       |
| :--- |:------------------------------------------|
| 초기 화면 | 로그인                                       |
| 원무 | 환자 접수 신청                                  |
| 진료 | 환자 조회, 처방전 지정, 치료 일수 입력, 처방 내림, 외래 기록지 저장 |
| 원무 | 수납 조회, 수납 처리                              |

- 할머니께서 환자의 이름을 제대로 모르시자 안내원은 환자의 이름을 '김'으로만 조회했다.
- 그런데 시스템의 응답이 없어서 안내원은 계속 검색 버튼을 누르기 시작했다.
- 안내원이 검색을 누른 후부터 해당 애플리케이션이 DB의 CPU 대부분을 점유했고, 결국 당연히 오픈도 연기되었다.
- 다른 프로젝트의 사례
- 시스템의 로그분석을 해서 하나의 화면이 한 시간에 10만번 이상 호출되는 것을 발견하였다.
- 문제가 된 화면은 천 개가 넘는 관련 협력사의 요청처리정보가 그 시간대에 공개되는 화면이었다.
- 기존 서버구성은 두 대의 서버가 있고, 각 서버에 있는 인스턴스 3개가 서로 클러스터링이 되어 있었다.
- 각 서버당 하나의 인스턴스에서는 문제되는 화면만 수행하고, 나머지 인스턴스에서는 나머지 모든 화면을 수행하도록 수정하였다.
- 문제되는 화면만 수행하도록 한 서버 인스턴스들만 다운되었고, 나머지 시스템은 정상적인 서비스를 수행하였다.
- 진단한 결과
  - 호출되는 화면의 응답 속도는 0.2~0.3초로 양호하다.
  - 검색 시 DB 쿼리 수행 시간대 애플리케이션 수행시간의 비율은 8:2로, DB에서 많은 응답시간이 소요되었다.
  - 검색 조건 화면을 로딩할 때 DB에서 3회 검색을 수행한다.
- 실제 응답속도는 0.2-0.3초가 소요되지만, 화면의 응답속도는 사용자가 증가할수록 중가하는 현상이 발생하였다.
- 이는 DB 쿼리 수행시간 및 애플리케이션 수행시간이 증가하면서 발생하는 당연한 현상이다.
## 왜 로그인 화면을 튜닝(분석)해야 하는가?
| 구분 | 화면명                                |
| :--- |:-----------------------------------|
| 로그인 | 로그인 화면 및 초기 화면                     |
| 메일 | 메일 목록 및 상세 조회, 메일 작성 및 발송          |
| 게시 | 게시물 목록 및 상세 조회                     |
| 결재 | 결재 목록 및 상세 조회, 결재 작성 및 상신, 결재 수행   |
| 임직원 조회 | 임직원 조회 및 상세 조회                     |
| 커뮤니티 | 커뮤니티 초기 화면, 게시물 목록 및 상세 조회, 게시물 작성 |
| 메신저 | 사용자 목록, 메시지 전송 및 수신                |
- 그룹웨어의 사용자가 가장 집중되는 시간은 오전 출근 시간대(7시 30분-9시 30분 사이)와 오후 중식 이후 시간대(12시30분~ 2시)일 것이다.
- 이 시간대에 로그인이 안 되면 메일, 게시, 결재 등 중요한 업무를 처리할 기회조차 없다.
- 그리고 임직원 조회가 되지 않으면 메일 발송 및 결재 상신도 절대 수행될 수 없다.
- 로그인 시 몇 번의 요청(request)을 수행하는지 조사해 보았다.
- 필자는 15~20개 정도의 요청을 예상하였지만, 예상외로 46회나 되는 요청을 수행하고 있었다.

| 컴포넌트 명 | 개수 |
| :--- | :--- |
| 로그인 프로세스 관련 | 2개 |
| 포틀릿 관련 | 20개 |
| SSO 등 컴포넌트 관련 | 5개 |
| 기타 | 19개 |
- 가장 많이 사용하는 로그인 화면이 얼마나 많은 요청을 수행하는지, 필요없는 요청이 있는지 확인하기 바란다.
## 쇼핑몰 사이트에서는...
| 구분 | 화면명                                    |
| :--- |:---------------------------------------|
| 메인 화면 | 초기 화면, 대분류 선택, 중분류 선택, 소분류 선택          |
| 검색 | 상품 검색, 상품 상세 조회                        |
| 전자 결제 | 로그인 및 즉시 결제 선택, 구매자 상세 정보 입력, 전자 결제 수행 |
| My Page | 구매한 상품 목록                              |
| 이벤트 | 이벤트 조회                                 |
- 일반적으로 소비자는 원하는 물건을 구매할 때 쇼핑몰이나 가격비교 사이트를 통하여 상품을 조회하고, 제품의 상세정보를 조회한다.
- 쇼핑몰이나 가격 비교 사이트의 초기 페이지가 열리지 않거나, 제품의 상세정보 조회가 되지 않으면 해당 사이트는 많은 고객을 잃는다.